
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>9. Grouping and Pivoting &#8212; Data Science with Python</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/quantecon-book-theme.857ff391aaabaeb8c161d2309c375fe6.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">


    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="../../_static/quantecon-book-theme.76bf49d7bbc59738cdb03766fad654af.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../_static/mvlogo.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="10. Working with Multiple DataFrames" href="Merge%20and%20Concat%20Dataset.html" />
    <link rel="prev" title="8. DataFrames in Python" href="Pandas%20Intro.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="" />
<meta name="keywords" content="" />
<meta name="description" content=Grouping and Pivoting  &lt;hr style=&#34;height:0.6px;border:none;color:#666;background-color:#666;&#34; /&gt;   In this section, we will answer the question:  What were the  />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:title" content="Grouping and Pivoting"/>
<meta name="twitter:description" content="Grouping and Pivoting  &lt;hr style=&#34;height:0.6px;border:none;color:#666;background-color:#666;&#34; /&gt;   In this section, we will answer the question:  What were the ">
<meta name="twitter:creator" content="@">
<meta name="twitter:image" content="">

<!-- Opengraph tags -->
<meta property="og:title" content="Grouping and Pivoting" />
<meta property="og:type" content="website" />
<meta property="og:url" content="None" />
<meta property="og:image" content="https://raw.githubusercontent.com/Ashray-shetty/bookcopy/main/Multiverse_Logo_RGB_Indigo-02.png" />
<meta property="og:description" content="Grouping and Pivoting  &lt;hr style=&#34;height:0.6px;border:none;color:#666;background-color:#666;&#34; /&gt;   In this section, we will answer the question:  What were the " />
<meta property="og:site_name" content="Data Science with Python" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="wrapper">

        <div class="main">

            <div class="page" id=Chapters/04/Pandas grouping and pivoting>

                <div class="page__toc">

                    <div class="inner">

                        
                        <div class="page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grouping">
   9.1. Grouping
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grouping-on-multiple-columns">
   9.2. Grouping on Multiple Columns
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pivoting">
   9.3. Pivoting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   9.4. Summary
  </a>
 </li>
</ul>

                            <p class="logo">
                                
                                    
                                    <a href=https://community.multiverse.io/><img src="../../_static/mvlogo.png" class="logo" alt="logo"></a>
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="page__header">

                    <div class="page__header-copy">

                        <p class="page__header-heading"><a href="../../intro.html">Data Science with Python</a></p>

                        <p class="page__header-subheading">Grouping and Pivoting</p>

                    </div>

                    <p class="page__header-authors"></p>

                </div> <!-- .page__header -->



                
                <main class="page__content" role="main">
                    
                    <div>
                        
  <div class="section" id="grouping-and-pivoting">
<h1><span class="section-number">9. </span>Grouping and Pivoting<a class="headerlink" href="#grouping-and-pivoting" title="Permalink to this headline">¶</a></h1>
<hr style="height:0.6px;border:none;color:#666;background-color:#666;" />
<p>In this section, we will answer the question:</p>
<p><strong>What were the most popular male and female names in each year?</strong></p>
<p>Here’s the Baby Names dataset once again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">baby</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;babynames.csv&#39;</span><span class="p">)</span>
<span class="n">baby</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1"># the .head() method outputs the first five rows of the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Sex</th>
      <th>Count</th>
      <th>Year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Mary</td>
      <td>F</td>
      <td>9217</td>
      <td>1884</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Anna</td>
      <td>F</td>
      <td>3860</td>
      <td>1884</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Emma</td>
      <td>F</td>
      <td>2587</td>
      <td>1884</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Elizabeth</td>
      <td>F</td>
      <td>2549</td>
      <td>1884</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Minnie</td>
      <td>F</td>
      <td>2243</td>
      <td>1884</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Breaking the Problem Down</strong></p>
<p>We decompose this problem into simpler table manipulations.</p>
<ol class="simple">
<li><p>Group the <code class="docutils literal notranslate"><span class="pre">baby</span></code> DataFrame by ‘Year’ and ‘Sex’.</p></li>
<li><p>For each group, compute the most popular name.</p></li>
</ol>
<p>Recognizing which operation is needed for each problem is sometimes tricky. Usually, a convoluted series of steps will signal to you that there might be a simpler way to express what you want. If we didn’t immediately recognize that we needed to group, for example, we might write steps like the following:</p>
<ol class="simple">
<li><p>Loop through each unique year.</p></li>
<li><p>For each year, loop through each unique sex.</p></li>
<li><p>For each unique year and sex, find the most common name.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is almost always a better alternative to looping over a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame. In particular, looping over unique values of a DataFrame should usually be replaced with a group.</p>
</div>
<div class="section" id="grouping">
<h2><span class="section-number">9.1. </span>Grouping<a class="headerlink" href="#grouping" title="Permalink to this headline">¶</a></h2>
<hr>
<p>To group in <code class="docutils literal notranslate"><span class="pre">pandas</span></code>. we use the <code class="docutils literal notranslate"><span class="pre">.groupby()</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baby</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x7f21b9674040&gt;
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.groupby()</span></code> returns a strange-looking <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> object. We can call <code class="docutils literal notranslate"><span class="pre">.agg()</span></code> on this object with an aggregation function in order to get a familiar output:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The aggregation function takes in a series of values for each group</span>
<span class="c1"># and outputs a single value</span>
<span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>

<span class="c1"># Count up number of values for each year. This is equivalent to</span>
<span class="c1"># counting the number of rows where each year appears.</span>
<span class="n">baby</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Sex</th>
      <th>Count</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1880</th>
      <td>2000</td>
      <td>2000</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>1881</th>
      <td>1935</td>
      <td>1935</td>
      <td>1935</td>
    </tr>
    <tr>
      <th>1882</th>
      <td>2127</td>
      <td>2127</td>
      <td>2127</td>
    </tr>
    <tr>
      <th>1883</th>
      <td>2084</td>
      <td>2084</td>
      <td>2084</td>
    </tr>
    <tr>
      <th>1884</th>
      <td>2297</td>
      <td>2297</td>
      <td>2297</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>33715</td>
      <td>33715</td>
      <td>33715</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>33253</td>
      <td>33253</td>
      <td>33253</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>33206</td>
      <td>33206</td>
      <td>33206</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>33063</td>
      <td>33063</td>
      <td>33063</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>32868</td>
      <td>32868</td>
      <td>32868</td>
    </tr>
  </tbody>
</table>
<p>137 rows × 3 columns</p>
</div></div></div>
</div>
<p>You might notice that the <code class="docutils literal notranslate"><span class="pre">length</span></code> function simply calls the <code class="docutils literal notranslate"><span class="pre">len</span></code> function, so we can simplify the code above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baby</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Sex</th>
      <th>Count</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1880</th>
      <td>2000</td>
      <td>2000</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>1881</th>
      <td>1935</td>
      <td>1935</td>
      <td>1935</td>
    </tr>
    <tr>
      <th>1882</th>
      <td>2127</td>
      <td>2127</td>
      <td>2127</td>
    </tr>
    <tr>
      <th>1883</th>
      <td>2084</td>
      <td>2084</td>
      <td>2084</td>
    </tr>
    <tr>
      <th>1884</th>
      <td>2297</td>
      <td>2297</td>
      <td>2297</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>33715</td>
      <td>33715</td>
      <td>33715</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>33253</td>
      <td>33253</td>
      <td>33253</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>33206</td>
      <td>33206</td>
      <td>33206</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>33063</td>
      <td>33063</td>
      <td>33063</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>32868</td>
      <td>32868</td>
      <td>32868</td>
    </tr>
  </tbody>
</table>
<p>137 rows × 3 columns</p>
</div></div></div>
</div>
<p>A further shorthand to accomplish the same result would be by using .count() method as our aggregating function. Pandas has shorthands for common aggregation functions, including <code class="docutils literal notranslate"><span class="pre">count</span></code>,<code class="docutils literal notranslate"> <span class="pre">sum</span></code>, and <code class="docutils literal notranslate"><span class="pre">mean</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baby</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Sex</th>
      <th>Count</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1880</th>
      <td>2000</td>
      <td>2000</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>1881</th>
      <td>1935</td>
      <td>1935</td>
      <td>1935</td>
    </tr>
    <tr>
      <th>1882</th>
      <td>2127</td>
      <td>2127</td>
      <td>2127</td>
    </tr>
    <tr>
      <th>1883</th>
      <td>2084</td>
      <td>2084</td>
      <td>2084</td>
    </tr>
    <tr>
      <th>1884</th>
      <td>2297</td>
      <td>2297</td>
      <td>2297</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>33715</td>
      <td>33715</td>
      <td>33715</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>33253</td>
      <td>33253</td>
      <td>33253</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>33206</td>
      <td>33206</td>
      <td>33206</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>33063</td>
      <td>33063</td>
      <td>33063</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>32868</td>
      <td>32868</td>
      <td>32868</td>
    </tr>
  </tbody>
</table>
<p>137 rows × 3 columns</p>
</div></div></div>
</div>
<p>The aggregation is applied to each column of the DataFrame, producing redundant information. We can restrict the output columns by slicing before grouping.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year_rows</span> <span class="o">=</span> <span class="n">baby</span><span class="p">[[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Count&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
<span class="n">year_rows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Count</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1880</th>
      <td>2000</td>
    </tr>
    <tr>
      <th>1881</th>
      <td>1935</td>
    </tr>
    <tr>
      <th>1882</th>
      <td>2127</td>
    </tr>
    <tr>
      <th>1883</th>
      <td>2084</td>
    </tr>
    <tr>
      <th>1884</th>
      <td>2297</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>33715</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>33253</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>33206</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>33063</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>32868</td>
    </tr>
  </tbody>
</table>
<p>137 rows × 1 columns</p>
</div></div></div>
</div>
<p>Note that the index of the resulting DataFrame now contains the unique years, so we can slice subsets of years using <code class="docutils literal notranslate"><span class="pre">.loc</span></code> as before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Every twentieth year starting at 1880</span>
<span class="n">year_rows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1880</span><span class="p">:</span><span class="mi">2016</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Count</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1880</th>
      <td>2000</td>
    </tr>
    <tr>
      <th>1900</th>
      <td>3730</td>
    </tr>
    <tr>
      <th>1920</th>
      <td>10755</td>
    </tr>
    <tr>
      <th>1940</th>
      <td>8961</td>
    </tr>
    <tr>
      <th>1960</th>
      <td>11924</td>
    </tr>
    <tr>
      <th>1980</th>
      <td>19440</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>29764</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="grouping-on-multiple-columns">
<h2><span class="section-number">9.2. </span>Grouping on Multiple Columns<a class="headerlink" href="#grouping-on-multiple-columns" title="Permalink to this headline">¶</a></h2>
<hr>
<p>We can group on multiple columns to get groups based on unique pairs of values. To do this, pass in a list of column labels into <code class="docutils literal notranslate"><span class="pre">.groupby()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grouped_counts</span> <span class="o">=</span> <span class="n">baby</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">grouped_counts</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Count</th>
    </tr>
    <tr>
      <th>Year</th>
      <th>Sex</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">1880</th>
      <th>F</th>
      <td>90992</td>
    </tr>
    <tr>
      <th>M</th>
      <td>110491</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1881</th>
      <th>F</th>
      <td>91953</td>
    </tr>
    <tr>
      <th>M</th>
      <td>100743</td>
    </tr>
    <tr>
      <th>1882</th>
      <th>F</th>
      <td>107847</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>2014</th>
      <th>M</th>
      <td>1913434</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2015</th>
      <th>F</th>
      <td>1776538</td>
    </tr>
    <tr>
      <th>M</th>
      <td>1907211</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2016</th>
      <th>F</th>
      <td>1756647</td>
    </tr>
    <tr>
      <th>M</th>
      <td>1880674</td>
    </tr>
  </tbody>
</table>
<p>274 rows × 1 columns</p>
</div></div></div>
</div>
<p>The code above computes the total number of babies born for each year and sex. We can now use grouping by multiple columns to compute the most popular names for each year and sex. Since the data are already sorted in descending order of Count for each year and sex, we can define an aggregation function that returns the first value in each series. (If the data weren’t sorted, we can call <code class="docutils literal notranslate"><span class="pre">sort_values()</span></code> first.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The most popular name is simply the first one that appears in the series</span>
<span class="k">def</span> <span class="nf">most_popular</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">baby_pop</span> <span class="o">=</span> <span class="n">baby</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">most_popular</span><span class="p">)</span>
<span class="n">baby_pop</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Name</th>
      <th>Count</th>
    </tr>
    <tr>
      <th>Year</th>
      <th>Sex</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">1880</th>
      <th>F</th>
      <td>Mary</td>
      <td>7065</td>
    </tr>
    <tr>
      <th>M</th>
      <td>John</td>
      <td>9655</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1881</th>
      <th>F</th>
      <td>Mary</td>
      <td>6919</td>
    </tr>
    <tr>
      <th>M</th>
      <td>John</td>
      <td>8769</td>
    </tr>
    <tr>
      <th>1882</th>
      <th>F</th>
      <td>Mary</td>
      <td>8148</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2014</th>
      <th>M</th>
      <td>Noah</td>
      <td>19263</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2015</th>
      <th>F</th>
      <td>Emma</td>
      <td>20415</td>
    </tr>
    <tr>
      <th>M</th>
      <td>Noah</td>
      <td>19594</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2016</th>
      <th>F</th>
      <td>Emma</td>
      <td>19414</td>
    </tr>
    <tr>
      <th>M</th>
      <td>Noah</td>
      <td>19015</td>
    </tr>
  </tbody>
</table>
<p>274 rows × 2 columns</p>
</div></div></div>
</div>
<p>Notice that grouping by multiple columns results in multiple labels for each row. This is called a “multilevel index” and is tricky to work with. The important thing to know is that <code class="docutils literal notranslate"><span class="pre">.loc</span></code> takes in a tuple for the row index instead of a single value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baby_pop</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="mi">2000</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">),</span> <span class="s1">&#39;Name&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Emily&#39;
</pre></div>
</div>
</div>
</div>
<p>But <code class="docutils literal notranslate"><span class="pre">.iloc</span></code> behaves the same as usual since it uses indices instead of labels:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baby_pop</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Name</th>
      <th>Count</th>
    </tr>
    <tr>
      <th>Year</th>
      <th>Sex</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">1885</th>
      <th>F</th>
      <td>Mary</td>
      <td>9128</td>
    </tr>
    <tr>
      <th>M</th>
      <td>John</td>
      <td>8756</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1886</th>
      <th>F</th>
      <td>Mary</td>
      <td>9889</td>
    </tr>
    <tr>
      <th>M</th>
      <td>John</td>
      <td>9026</td>
    </tr>
    <tr>
      <th>1887</th>
      <th>F</th>
      <td>Mary</td>
      <td>9888</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="pivoting">
<h2><span class="section-number">9.3. </span>Pivoting<a class="headerlink" href="#pivoting" title="Permalink to this headline">¶</a></h2>
<hr>
<p><strong>If you group by two columns, you can often use pivot to present your data in a more convenient format.</strong> Using a pivot lets you use one set of grouped labels as the columns of the resulting table.</p>
<p>To pivot, use the <code class="docutils literal notranslate"><span class="pre">pd.pivot_table()</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">baby</span><span class="p">,</span>
               <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span>         <span class="c1"># Index for rows</span>
               <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Sex&#39;</span><span class="p">,</span>        <span class="c1"># Columns</span>
               <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span>        <span class="c1"># Values in table</span>
               <span class="n">aggfunc</span><span class="o">=</span><span class="n">most_popular</span><span class="p">)</span> <span class="c1"># Aggregation function</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Sex</th>
      <th>F</th>
      <th>M</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1880</th>
      <td>Mary</td>
      <td>John</td>
    </tr>
    <tr>
      <th>1881</th>
      <td>Mary</td>
      <td>John</td>
    </tr>
    <tr>
      <th>1882</th>
      <td>Mary</td>
      <td>John</td>
    </tr>
    <tr>
      <th>1883</th>
      <td>Mary</td>
      <td>John</td>
    </tr>
    <tr>
      <th>1884</th>
      <td>Mary</td>
      <td>John</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>Sophia</td>
      <td>Jacob</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>Sophia</td>
      <td>Noah</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>Emma</td>
      <td>Noah</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>Emma</td>
      <td>Noah</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>Emma</td>
      <td>Noah</td>
    </tr>
  </tbody>
</table>
<p>137 rows × 2 columns</p>
</div></div></div>
</div>
<p>Compare this result to the <code class="docutils literal notranslate"><span class="pre">baby_pop</span></code> table that we computed using <code class="docutils literal notranslate"><span class="pre">.groupby()</span></code>. We can see that the <code class="docutils literal notranslate"><span class="pre">Sex</span></code> index in <code class="docutils literal notranslate"><span class="pre">baby_pop</span></code> became the columns of the pivot table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baby_pop</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Name</th>
      <th>Count</th>
    </tr>
    <tr>
      <th>Year</th>
      <th>Sex</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">1880</th>
      <th>F</th>
      <td>Mary</td>
      <td>7065</td>
    </tr>
    <tr>
      <th>M</th>
      <td>John</td>
      <td>9655</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1881</th>
      <th>F</th>
      <td>Mary</td>
      <td>6919</td>
    </tr>
    <tr>
      <th>M</th>
      <td>John</td>
      <td>8769</td>
    </tr>
    <tr>
      <th>1882</th>
      <th>F</th>
      <td>Mary</td>
      <td>8148</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2014</th>
      <th>M</th>
      <td>Noah</td>
      <td>19263</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2015</th>
      <th>F</th>
      <td>Emma</td>
      <td>20415</td>
    </tr>
    <tr>
      <th>M</th>
      <td>Noah</td>
      <td>19594</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2016</th>
      <th>F</th>
      <td>Emma</td>
      <td>19414</td>
    </tr>
    <tr>
      <th>M</th>
      <td>Noah</td>
      <td>19015</td>
    </tr>
  </tbody>
</table>
<p>274 rows × 2 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="summary">
<h2><span class="section-number">9.4. </span>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<hr>
<p>We now have the most popular baby names for each sex and year in our dataset and learned to express the following operations in <code class="docutils literal notranslate"><span class="pre">pandas</span></code>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Operation</p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">pandas</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Group</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">df.groupby(label)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Group by multiple columns</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">df.groupby([label1,</span> <span class="pre">label2])</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Group and aggregate</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">df.groupby(label).agg(func)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Pivot</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pd.pivot_table()</span></code></p></td>
</tr>
</tbody>
</table>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "communitylab/data",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Chapters/04"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="sidebar bd-sidebar inactive persistent" id="site-navigation">

                <div class="sidebar__header">


                    Contents

                </div>

                <nav class="sidebar__nav" id="sidebar-nav" aria-label="Main navigation">
                    <p class="caption">
 <span class="caption-text">
  Programming with Python
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../01/intro_python.html">
   1. Introduction to Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02/Sequence%2C%20Loops%20and%20Methods.html">
   2. Sequence, Loops and Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03/Dictionaries%20and%20Comprehensions.html">
   3. Dictionaries and Comprehensions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02/Exercise%2001.html">
   4. 📝 Exercise 01
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02/Solutions%2001.html">
   5. 📃 Solution for Exercise 01
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03/Functions%20and%20Exceptions.html">
   6. Functions and Exceptions
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data Wrangling with Python
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="NumPy.html">
   7. Introduction to Numpy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Pandas%20Intro.html">
   8. DataFrames in Python
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   9. Grouping and Pivoting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Merge%20and%20Concat%20Dataset.html">
   10. Working with Multiple DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Pandas%20apply%20strings%20and%20plotting.html">
   11. Applying Functions and Plotting in Pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05/sql%20intro.html">
   12. Relational Databases and SQL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../06/viz%20intro.html">
   13. Data Visualization
  </a>
 </li>
</ul>

                </nav>

                <div class="sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="toolbar">

            <div class="toolbar__inner">

                <ul class="toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="../../intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://community.multiverse.io/" title=""><span class="show-for-sr">Multiverse</span></a></li>
                    <!-- <li class="btn__search">
                        <form action="../../search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off">
                            <i data-feather="search"></i>
                        </form>
                    </li> -->
                </ul>

                <ul class="toolbar__links">
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/communitylab/data/tree/main/Chapters/04/Pandas grouping and pivoting.ipynb" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://mybinder.org/v2/gh/communitylab/data/main?urlpath=tree/Chapters/04/Pandas grouping and pivoting.ipynb">BinderHub</option>
                
                    <option value="https://colab.research.google.com/github/communitylab/data/blob/main/Chapters/04/Pandas grouping and pivoting.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/communitylab/data" data-urlpath="tree/data/Chapters/04/Pandas grouping and pivoting.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://mybinder.org/v2/gh/communitylab/data/main?urlpath=tree/Chapters/04/Pandas grouping and pivoting.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "Chapters/04/Pandas grouping and pivoting";
                const repoURL = "https://github.com/communitylab/data";
                const urlPath = "tree/data/Chapters/04/Pandas grouping and pivoting.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
    
  </body>
</html>